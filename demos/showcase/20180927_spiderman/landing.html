<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>

    <!-- <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous"> -->
    <script src="https://man.vm5apis.com/dist/anime.js/2.0.2/anime.min.js"></script>

    <style media="screen">
    body {
      display: flex;
      justify-content: center;
      align-items: center;

      height: 100vh;
      width: 100vw;
      margin: 0;

      /*
      background: linear-gradient(to bottom, #DF5E6A, #E76B51);
      */
      background-image: url('landing/BG.png');
      /* background-size: 400% 100vh; */
      background-size: 400% 400%;
    }
    .page {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      align-self: center;

      height: calc((1000/667)*100vw);
      width: calc((667/667)*100vw);
      max-width: 100vw;
      max-height: 100vh;
      background-image: url('landing/BG.png');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center 0%;
    }
    .page.hfirst {
      height: calc(1000vh/10);
      width: calc(667vh/10);
    }
    .scene {
      display: block;
      position: absolute;

      height: 100%;
      width: 100%;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center 0%;
    }
    </style>
  </head>
  <body>
    <div class="page">

    </div>
    <script type="text/javascript">
    function checkRatio() {
      let pageEl = document.querySelector('.page');
      let h = window.innerHeight ? window.innerHeight : 1;
      let w = window.innerWidth ? window.innerWidth : 1;
      if (h/w < 1000/667) {
        if (!pageEl.classList.contains('hfirst')) {
          pageEl.classList.add('hfirst');
        }
      } else {
        pageEl.classList.remove('hfirst');
      }
    }
    window.addEventListener('resize', checkRatio);
    checkRatio();
    </script>
    <script type="text/javascript">
    // NOTE Init Scene Welcome
    function initSceneWelcome(self) {
      let rootView = self.el;
      rootView.style.backgroundImage = 'url(landing/01.png)';

      let startButtonEl = document.createElement('img');
      startButtonEl.src = 'landing/BTN.png';
      startButtonEl.classList.add('startButton');
      startButtonEl.style.width = '60%';
      startButtonEl.style.position = 'absolute';
      startButtonEl.style.bottom = '5%';
      startButtonEl.style.left = '50%';
      startButtonEl.style.transform = 'translate(-50%, 0)';
      // startButtonEl.style.borderRadius = '50%';
      startButtonEl.addEventListener('click', function () {
        if (startButtonEl.animationInstance) {
          startButtonEl.animationInstance.pause();
        }
        anime({
          targets: rootView,
          opacity: [1, 0],

          // direction: 'alternate',
          // loop: true,
          easing: 'linear',

          duration: 500,

          complete: function () {
            showTargetScene(1);
          }
        });
      });
      startButtonEl.animationInstance = anime({
        targets: startButtonEl,
        loop: true,

        direction: 'alternate',
        marginLeft: ['-=5%', '0%'],
      });
      rootView.appendChild(startButtonEl);
    }

    // NOTE Enter Scene Welcome
    function enterSceneWelcome(self) {
      let rootView = self.el;
      anime({
        targets: rootView,
        opacity: [0, 1],

        // direction: 'alternate',
        // loop: true,
        easing: 'linear',

        duration: 500,

        complete: function () {
          //
        }
      });
    }
    </script>
    <script type="text/javascript">
    let characterList = [
      {
        statusBase: 'url(landing/char_miles.png)',
        statusImageList: [
          'landing/char_miles1.png',
          'landing/char_miles2.png',
        ],
        statusImageElList: [],
        nameImage: 'landing/name_miles.png',
        clickImage: 'landing/click_miles.png',
        personImage: 'landing/miles.png',
        foundImage: 'landing/found_miles.png',

        clickImageElTop: '25%',
        clickImageElLeft: '10%',
        personImageElTop: '50%',
        personImageElLeft: '50%',
        foundImageElTop: '20%',
        foundImageElLeft: '50%',
      },
      {
        statusBase: 'url(landing/char_peter.png)',
        statusImageList: [
          'landing/char_peter1.png',
          'landing/char_peter2.png',
        ],
        statusImageElList: [],
        nameImage: 'landing/name_peter.png',
        clickImage: 'landing/click_peter.png',
        personImage: 'landing/peter.png',
        foundImage: 'landing/found_peter.png',

        clickImageElTop: '0%',
        clickImageElLeft: '91%',
        personImageElTop: '25%',
        personImageElLeft: '50%',
        foundImageElTop: '60%',
        foundImageElLeft: '50%',
      },
      {
        statusBase: 'url(landing/char_gwen.png)',
        statusImageList: [
          'landing/char_gwen1.png',
          'landing/char_gwen2.png',
        ],
        statusImageElList: [],
        nameImage: 'landing/name_gwen.png',
        clickImage: 'landing/click_gwen.png',
        personImage: 'landing/gwen.png',
        foundImage: 'landing/found_gwen.png',

        clickImageElTop: '0%',
        clickImageElLeft: '0%',
        personImageElTop: '25%',
        personImageElLeft: '50%',
        foundImageElTop: '60%',
        foundImageElLeft: '50%',
      },
      {
        statusBase: 'url(landing/char_noir.png)',
        statusImageList: [
          'landing/char_noir1.png',
          'landing/char_noir2.png',
        ],
        statusImageElList: [],
        nameImage: 'landing/name_noir.png',
        clickImage: 'landing/click_noir.png',
        personImage: 'landing/noir.png',
        foundImage: 'landing/found_noir.png',

        clickImageElTop: '55%',
        clickImageElLeft: '8%',
        personImageElTop: '80%',
        personImageElLeft: '50%',
        foundImageElTop: '30%',
        foundImageElLeft: '50%',
      },
      {
        statusBase: 'url(landing/char_peni.png)',
        statusImageList: [
          'landing/char_peni1.png',
          'landing/char_peni2.png',
        ],
        statusImageElList: [],
        nameImage: 'landing/name_peni.png',
        clickImage: 'landing/click_peni.png',
        personImage: 'landing/peni.png',
        foundImage: 'landing/found_peni.png',

        clickImageElTop: '71%',
        clickImageElLeft: '48%',
        personImageElTop: '80%',
        personImageElLeft: '50%',
        foundImageElTop: '30%',
        foundImageElLeft: '50%',
      },
    ];
    function getNextCharacter() {
      let lastOfUs = characterList.filter(function (item) {
        return !item.isDone;
      });
      if (lastOfUs.length > 0) {
        return lastOfUs[0];
      }
    }
    function isAllCharacterFound() {
      return getNextCharacter() === undefined;
    }
    function goNextCharacter() {
      let nextOne = getNextCharacter();
      if (nextOne) {
        let hintFindImageEl = document.querySelector('#hintFindImageEl');
        hintFindImageEl.style.display = 'block';
        anime.timeline().add({
          targets: hintFindImageEl,
          // scale: [1, 1.5, 1],
          // translateX: ['-50%','-50%','-50%'],
          // translateY: ['-50%','-50%','-50%'],
          opacity: [0, 1],
          easing: 'linear',
          duration: 500,
        }).add({
          targets: hintFindImageEl,
          translateX: ['-50%','-50%',],
          translateY: ['-50%','-50%',],
          opacity: [1, 0],
          easing: 'linear',
          delay: 500,
          duration: 500,

          complete: function () {
            hintFindImageEl.style.display = 'none';

            nextOne.clickImageEl.style.display = 'block';
            anime({
              targets: nextOne.clickImageEl,
              opacity: [0, 1],
              easing: 'linear',
              duration: 500,
              complete: function () {
                //
              },
            })
            ;
          },
        });
      } else {
        showTargetScene(2);
      }
    }

    // NOTE Init Scene Play
    function initScenePlay(self) {
      let rootView = self.el;
      // rootView.style.backgroundImage = 'url(landing/01.png)';

      let hintFindImageEl = document.createElement('img');
      hintFindImageEl.id = 'hintFindImageEl';
      hintFindImageEl.src = 'landing/找出隱藏城市中的蜘蛛人 組成蜘蛛人新宇宙拯救世界 .png';
      hintFindImageEl.style.width = '70%';
      hintFindImageEl.style.position = 'absolute';
      hintFindImageEl.style.top = '30%';
      hintFindImageEl.style.left = '50%';
      hintFindImageEl.style.transform = 'translate(-50%, -50%)';
      hintFindImageEl.style.opacity = 0;
      hintFindImageEl.style.display = 'none';
      rootView.appendChild(hintFindImageEl);

      let characterStatusContainer = document.createElement('div');
      // characterStatusContainer.src = 'landing/BTN.png';
      characterStatusContainer.style.width = '90%';
      characterStatusContainer.style.height = '20%';
      characterStatusContainer.style.position = 'absolute';
      characterStatusContainer.style.bottom = '5%';
      characterStatusContainer.style.left = '50%';
      characterStatusContainer.style.transform = 'translate(-50%, 0)';
      characterStatusContainer.style.display = 'flex';
      characterStatusContainer.style.flexDirection = 'row';
      rootView.appendChild(characterStatusContainer);

      function newCharacter(character) {
        let div;

        let foundImageEl = document.createElement('img');
        foundImageEl.src = character.foundImage;
        foundImageEl.style.width = '80%';
        foundImageEl.style.position = 'absolute';
        foundImageEl.style.top = character.foundImageElTop;
        foundImageEl.style.left = character.foundImageElLeft;
        foundImageEl.style.transform = 'translate(-50%, -50%)';
        foundImageEl.style.opacity = 0;
        foundImageEl.style.display = 'none';
        character.foundImageEl = foundImageEl;
        rootView.appendChild(foundImageEl);
        let personImageEl = document.createElement('img');
        personImageEl.src = character.personImage;
        personImageEl.style.width = '70%';
        personImageEl.style.position = 'absolute';
        personImageEl.style.top = character.personImageElTop;
        personImageEl.style.left = character.personImageElLeft;
        personImageEl.style.transform = 'translate(-50%, -50%)';
        personImageEl.style.opacity = 0;
        personImageEl.style.display = 'none';
        character.personImageEl = personImageEl;
        rootView.appendChild(personImageEl);

        let clickImageEl = document.createElement('img');
        clickImageEl.src = character.clickImage;
        clickImageEl.style.width = '10%';
        clickImageEl.style.maxHeight = '10%';
        clickImageEl.style.position = 'absolute';
        clickImageEl.style.top = character.clickImageElTop;
        clickImageEl.style.left = character.clickImageElLeft;
        clickImageEl.style.transform = 'translate(-50%, -50%)';
        clickImageEl.style.opacity = 0;
        clickImageEl.style.display = 'none';
        function handleCharacterClicked(e) {
          if (!character.isDone) {
            character.isDone = true;

            // Hide the clickable element
            anime({
              targets: clickImageEl,
              opacity: [1, 0],
              easing: 'linear',
              duration: 500,
              complete: function () {
                clickImageEl.style.display = 'none';
              },
            })
            // Show Found
            foundImageEl.style.display = 'block';
            personImageEl.style.display = 'block';
            anime.timeline().add({
              targets: [character.foundImageEl, character.personImageEl,],
              scale: [1, 1.5, 1],
              translateX: ['-50%','-50%','-50%'],
              translateY: ['-50%','-50%','-50%'],
              opacity: [0, 1],
              easing: 'linear',
              duration: 500,
            }).add({
              targets: [character.foundImageEl, character.personImageEl,],
              opacity: [1, 0],
              easing: 'linear',
              delay: 500,
              duration: 500,

              complete: function () {
                foundImageEl.style.display = 'none';
                personImageEl.style.display = 'none';
              },
            });
            // Show Status
            anime({
              targets: character.statusBaseEl,
              scale: [1, 1.5, 1],
              easing: 'linear',
              duration: 500,
            })
            // Show Name
            anime({
              targets: character.nameImageEl,
              scale: [1, 1.5, 1],
              translateX: ['-50%','-50%','-50%'],
              opacity: [0, 1],
              easing: 'linear',
              duration: 500,
            })
            // NOTE Lighten the character portrait.
            let timeline = anime.timeline();
            for (let statusImageEl of character.statusImageElList) {
              timeline = timeline.add({
                targets: statusImageEl,
                opacity: [0, 1],
                easing: 'linear',
                duration: 500,
              })
            }
            timeline.complete = function () {
              setTimeout(function () {
                goNextCharacter();
              }, 500);
            };
          }
        }
        clickImageEl.addEventListener('click', handleCharacterClicked);
        anime({
          targets: clickImageEl,
          loop: true,

          // left: '40%',
          direction: 'alternate',
          rotate: ['15', '0'],

          // update: function () {console.log(theHintEl.style.left);
          //   // theHintEl.style.left = theHintEl.style.left;
          // },
        });
        character.clickImageEl = clickImageEl;
        rootView.appendChild(clickImageEl);

        let statusBaseEl = document.createElement('div');
        // statusBaseEl.src = 'landing/BTN.png';
        statusBaseEl.style.backgroundImage = character.statusBase;
        statusBaseEl.style.backgroundRepeat = 'no-repeat';
        statusBaseEl.style.backgroundSize = 'contain';
        statusBaseEl.style.backgroundPosition = 'center';
        statusBaseEl.style.position = 'relative';
        statusBaseEl.style.flex = 1;
        statusBaseEl.style.height = '100%';
        statusBaseEl.style.margin = '0 1% 0 1%';
        character.statusBaseEl = statusBaseEl;
        characterStatusContainer.appendChild(statusBaseEl);
        // NOTE Character Name
        div = document.createElement('img');
        div.src = character.nameImage;
        div.style.width = '90%';
        div.style.position = 'absolute';
        div.style.bottom = '0%';
        div.style.left = '50%';
        div.style.transform = 'translate(-50%, 0%)';
        div.style.opacity = 0;
        character.nameImageEl = div;
        statusBaseEl.appendChild(div);
        // NOTE Character Status Elements
        for (let statusImage of character.statusImageList) {
          div = document.createElement('img');
          div.src = statusImage;
          div.style.width = '100%';
          div.style.position = 'absolute';
          div.style.top = '50%';
          div.style.left = '50%';
          div.style.transform = 'translate(-50%, -50%)';
          div.style.opacity = 0;
          character.statusImageElList.push(div);
          statusBaseEl.appendChild(div);
        }
      }
      for (let character of characterList) {
        newCharacter(character);
      }
    }

    // NOTE Enter Scene Play
    function enterScenePlay(self) {
      let rootView = self.el;
      anime({
        targets: rootView,
        opacity: [0, 1],

        // direction: 'alternate',
        // loop: true,
        easing: 'linear',

        duration: 500,

        complete: function () {
          goNextCharacter();
        }
      });
    }
    </script>
    <script type="text/javascript">
    // NOTE Init Scene Ending
    function initSceneEnding(self) {
      let rootView = self.el;
      rootView.style.backgroundImage = 'url(landing/ending.png)';

      let div;

      div = document.createElement('img');
      div.src = 'landing/圖層 6.png';
      div.style.width = '100%';
      div.style.position = 'absolute';
      div.style.bottom = '5%';
      div.style.left = '50%';
      div.style.transform = 'translate(-50%, 0)';
      rootView.appendChild(div);
      div = document.createElement('img');
      div.src = 'landing/組隊成功！ 快分享抽電影兌換券.png';
      div.style.width = '60%';
      div.style.position = 'absolute';
      div.style.bottom = '60%';
      div.style.left = '55%';
      div.style.transform = 'translate(-50%, 0)';
      rootView.appendChild(div);

      let shareButtonEl = document.createElement('img');
      shareButtonEl.src = 'landing/btn-share.png';
      shareButtonEl.classList.add('shareButton');
      shareButtonEl.style.width = '40%';
      shareButtonEl.style.position = 'absolute';
      shareButtonEl.style.bottom = '42%';
      shareButtonEl.style.left = '50%';
      shareButtonEl.style.transform = 'translate(-50%, 0)';
      // shareButtonEl.style.borderRadius = '50%';
      shareButtonEl.addEventListener('click', function () {
        // if (shareButtonEl.animationInstance) {
        //   shareButtonEl.animationInstance.pause();
        // }
      });
      shareButtonEl.animationInstance = anime({
        targets: shareButtonEl,
        loop: true,

        direction: 'alternate',
        marginLeft: ['-=5%', '0%'],
      });
      rootView.appendChild(shareButtonEl);
    }

    // NOTE Enter Scene Ending
    function enterSceneEnding(self) {
      let rootView = self.el;
      anime({
        targets: rootView,
        opacity: [0, 1],

        // direction: 'alternate',
        // loop: true,
        easing: 'linear',

        duration: 500,

        complete: function () {
          //
        }
      });
    }
    </script>
    <script type="text/javascript">

      // NOTE Entry point
      let stageEl = document.querySelector('.page');
      let sceneList = [
        {
          init: initSceneWelcome,
          enter: enterSceneWelcome,
        },
        {
          init: initScenePlay,
          enter: enterScenePlay,
        },
        {
          init: initSceneEnding,
          enter: enterSceneEnding,
        },
      ];
      function showTargetScene(index) {
        for (var i = 0; i < sceneList.length; i++) {
          if (i == index) {
            sceneList[i].el.style.display = 'block';
            sceneList[i].enter(sceneList[i]);
          } else {
            sceneList[i].el.style.display = 'none';
          }
        }
      }
      // NOTE Init total basis
      function initWorld() {
        for (var index = 0; index < sceneList.length ; index++) {
          let sceneEl;
          sceneEl = document.createElement('div');
          sceneEl.classList.add('scene');
          sceneEl.classList.add('scene'+index);

          stageEl.appendChild(sceneEl);
          sceneList[index].el = sceneEl;

          sceneList[index].init(sceneList[index]);
        }

        showTargetScene(0);

        // TODO TEST
        // showTargetScene(1);
      }
      initWorld();
    </script>
  </body>
</html>
